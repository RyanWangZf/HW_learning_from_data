% Homework template for Learning from Data
% by Xiangxiang Xu <xiangxiangxu.thu@gmail.com>
% LAST UPDATE: October 8, 2018
\documentclass[a4paper]{article}
\usepackage[T1]{fontenc}
\usepackage{amsmath, amssymb, amsthm}
% amsmath: equation*, amssymb: mathbb, amsthm: proof
\usepackage{moreenum}
\usepackage{mathtools}
\usepackage{url}
\usepackage{enumitem}
\usepackage{bm}
\usepackage{graphicx}
\usepackage{subcaption}
\usepackage{booktabs} % toprule
\usepackage[mathcal]{eucal}
\usepackage{dsfont}
\usepackage[numbered,framed]{matlab-prettifier}
\input{lddef}

\lstset{
  style              = Matlab-editor,
  captionpos         =b,
  basicstyle         = \mlttfamily,
  escapechar         = ",
  mlshowsectionrules = true,
}

\begin{document}
\courseheader

\newcounter{hwcnt}
\setcounter{hwcnt}{2}

\begin{center}
    \underline{\bf Homework \thehwcnt} \\
\end{center}
\begin{flushleft}
    Zi-Feng WANG\hfill
    \today
\end{flushleft}
\hrule
\vspace{2em}
\setlist[enumerate,1]{label=\thehwcnt.\arabic*.}
\setlist[enumerate,2]{label={(\alph*)}
\setlist[enumerate,3]{label=\roman*.}
\setlist[enumerate,4]{label=\greek*)}

\flushleft
\rule{\textwidth}{1pt}
\begin{itemize}
\item {\bf Acknowledgments: \/}
    This template takes some materials from course CSE 547/Stat 548 of Washington University: \small 
    {\url{https://courses.cs.washington.edu/courses/cse547/17sp/index.html}}.
\item {\bf Collaborators: \/}
    I finish my homework all by myself.
\end{itemize}
\rule{\textwidth}{1pt}

\vspace{2em}


%%% Now Start the main part of this assignment. %%%

\begin{enumerate}
\item \textbf{Solution:}
let $\nabla J(\theta)=0$ and we can get the normal equation
\begin{equation}
X^{\T}X\bm{\theta} = X^{\T}\by 
\label{eq:1}
\end{equation}
from $x\in \reals^n$ we can get that the $X$ is a $m\times n$ matrix, hence $X^{\T}X$ is a $n\times n$ matrix
, $\bm{\theta}$ is $n\times 1$ vector and $X^{\T}\by$ is $n \times 1$ vector as well.
the \eqref{eq:1} can be represented as the following format
\begin{equation}
A\bm{\theta} = \bm{b}
\label{eq:2}
\end{equation}
in \eqref{eq:2}, the $A=X^{\T}X$, $b=X^{\T}\by$. if $A$ is a singular and square matrix, the $rank(A) < n$.
there are two possible cases: \\
\begin{enumerate}
\item when $rank(A)=rank(A,b)<n$, there are infinite number of solutions of $\bm{\theta}$
\item when $rank(A)<rank(A,b)<n$, there is none solution of $\bm{\theta}$
\end{enumerate}

\item \textbf{Solution:}
\begin{enumerate}
\item before getting $\nabla_{b_l}\ell$, unfold $\ell$ at first
    \begin{equation}
    \begin{aligned}
        \ell &= \sum_{i=1}^m \log P_{\rvy|\rvx}(y^{(i)}|x^{(i)})  \\
        &= \sum_{i=1}^m \log \frac{\exp(\theta_l^{\T}x^{(i)}+b_l)}{
            \sum_{j=1}^k \exp(\theta_j^{\T}x^{(i)}+b_j)} \\
        &= \sum_{i=1}^m (\theta_l^{\T}x^{(i)}+b_l)-\sum_{i=1}^m \log\sum_{j=1}^k\exp(\theta_j^{\T}x^{(i)}+b_j)
    \end{aligned}
    \label{eq:3}
    \end{equation}
    from \eqref{eq:3}, the $\nabla_{b_l}\ell$ is
    \begin{equation}
    \begin{aligned}
        \nabla_{b_l}\ell &= \nabla_{b_l}\{\sum_{i=1}^m 
            (\theta_l^{\T}x^{(i)}+b_l)-\sum_{i=1}^m \log\sum_{j=1}^k\exp(\theta_j^{\T}x^{(i)}+b_j)\}\\
        &= \sum_{i=1}^m \1 \{ y^{(i)}=l \} - \sum_{i=1}^m \frac1{\sum_{j=1}^k\exp(\theta_j^{\T}x+b_j) }
        \frac{\partial (\sum_{j=1}^k \exp(\theta_j^{\T}x^{(i)}+b_j))}{\partial b_l} \\
        &= \sum_{i=1}^m \1 \{ y^{(i)}=l \} - \sum_{i=1}^m\frac{\theta_l^{\T}x^{(i)}+b_l}
        {\sum_{j=1}^k \exp(\theta_j^{\T}x^{(i)}+b_j)}\\
        &= \sum_{i=1}^m (\1 \{y^{(i)}=l\} - P(y^{(i)}=l|x^{(i)};\theta,b))
    \end{aligned}
    \label{eq:4}
    \end{equation}
    \item 
    \begin{proof}
        when $\nabla_{b_l}\ell=0$, the $\eqref{eq:4}=0$, that is 
            $\sum_{i=1}^m (\1 \{y^{(i)}=l\} - P(y^{(i)}=l|x^{(i)};\theta,b)) = 0$.\\
        so that
        \begin{equation*}
        \begin{aligned}
        \sum_{i=1}^m \1\{y^{(i)}=l\} &= \sum_{i=1}^m P(y^{(i)}=l|x^{(i)};\theta,b) \\
        m\frac{\sum_{i=1}^m \1\{y^{(i)}=l\}}{m} &= 
            \sum_{i=1}^m \sum_{j=1}^m P(y^{(i)}=l|x^{(i)};\theta,b) \1\{x^{(i)}=x^{(j)}\} \\
        \hat{P}_{\rvy}(l) &= \frac1m \sum_{i=1}^m P(y^{(i)}=l|x^{(i)};\theta,b) 
            \sum_{j=1}^m \1\{x^{(i)}=x^{(j)}\} \\
        \hat{P}_{\rvy}(l) &= \sum_{x\in \mathcal{X}} P_{\rvy|\rvx}(l|x)\hat{P}_{\rvx}(x) 
        \end{aligned}
        \end{equation*}
    \end{proof}
\end{enumerate}
    \item the multivariate normal distribution can be written as 
    \begin{equation}
    \begin{aligned}
    p_\rvy(y;\mu,\Sigma) &= \frac1{(2\pi)^{\frac{n}2}|\Sigma|^{\frac12}} 
        \exp(-\frac12(y-\mu)^{\T}\Sigma^{-1}(y-\mu)) \\ 
      &= \frac1{(2\pi)^{\frac{n}2}} \exp\{ -\frac12\log|\Sigma| -\frac12(y-\mu)^{\T}\Sigma^{-1}(y-\mu)\} \\
    \end{aligned}
    \label{eq:5}
    \end{equation}
    the part in $\exp(\cdot)$ of \eqref{eq:5} is
    \begin{equation}
    \begin{aligned}
    &-\frac12\log|\Sigma| -\frac12(y-\mu)^{\T}\Sigma^{-1}(y-\mu) \\
    &= -\frac12\log|\Sigma| - \frac12(y^{\T}\Sigma^{-1}y-y^{\T}\Sigma^{-1}\mu-\mu^{\T}\Sigma^{-1}y
        + \mu^{\T}\Sigma^{-1}\mu) \\
    &= -\frac12(tr(y^{\T}\Sigma^{-1}y)-tr(y^{\T}\Sigma^{-1}\mu)-tr(\mu^{\T}\Sigma^{-1}y) )
        -\frac12(\log|\Sigma| + \mu^{\T}\Sigma^{-1}\mu) \\
    &= -\frac12(tr(\Sigma^{-1}yy^{\T})-tr(\Sigma^{-1}\mu y^{\T})-tr(\mu^{\T}\Sigma^{-1}y) )
        -\frac12(\log|\Sigma| + \mu^{\T}\Sigma^{-1}\mu) \\
    &= -\frac12tr(\Sigma^{-1}yy^{\T}-\Sigma^{-1}\mu y^{\T}-\mu^{\T}\Sigma^{-1}y)
        -\frac12(\log|\Sigma| + \mu^{\T}\Sigma^{-1}\mu) 
    \end{aligned}
    \label{eq:6}
    \end{equation}
    let 
    \begin{equation}
    \begin{align}
    &\bm{\eta} = -\frac12(\Sigma^{-1},\Sigma^{-1}\mu,\mu^{\T}\Sigma^{-1})^{\T} \\
    &T(y) = (yy^{\T},y^{\T},y)^{\T}
    \end{align}
    \label{eq:7}
    \end{equation}
    therefore the \eqref{eq:6} can be written as
    \begin{equation}
    tr(\bm{\eta}^{\T}T(y)) - \frac12(\log|\Sigma| + \mu^{\T}\Sigma^{-1}\mu) = 
    \langle \bm{\eta},T(y) \rangle_F\footnotemark[1] - a(\bm{\eta})
    \label{eq:8}
    \end{equation}
    \footnotetext[1]{the $\langle A,B \rangle_F$ is the \emph{Frobenius inner product}
    used to define the inner product 
        between two matrices $A$ and $B$, which is represented as the trace of their products
        i.e. $tr(A^{\T}B)$.}
    combine the \eqref{eq:5}, \eqref{eq:6}, \eqref{eq:7} and \eqref{eq:8}, we can show that the 
    multivariate normal distribution is an exponential family
    \begin{equation}
    P_{\rvy}(y;\bm{\eta}) = b(y)\exp(\langle \bm{\eta},T(y) \rangle_F - a(\bm{\eta}))
    \end{equation}
    where 
    \begin{equation*}
    \begin{align}
    &b(y) = \frac1{(2\pi)^{\fracn2}} \\
    &\bm{\eta} = -\frac12(\Sigma^{-1},\Sigma^{-1}\mu,\mu^{\T}\Sigma^{-1})^{\T} \\
    &T(y) = (yy^{\T},y^{\T},y)^{\T} \\
    &a(\bm{\eta}) =  \frac12(\log|\Sigma| + \mu^{\T}\Sigma^{-1}\mu) 
    \end{align}
    \end{equation*}
\end{enumerate}


\end{document}
